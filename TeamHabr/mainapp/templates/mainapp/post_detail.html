{% extends 'mainapp_base.html' %}
{% load static %}
{% load auth_extras %}


{% block content %}


<div class="container-fluid">
    <div class="row">
        <div class="col-2"></div>
        <div class="col text-justify bg-white">
            <p class="h2 text-center">{{object.title}}
                <span id="like_post" style="font-size: 14px"><a {% if user.is_authenticated %} href="{% url 'main:like' object.pk 'post' %}" {% else %} href="#myModal" data-toggle="modal" {% endif %}><i class="bi bi-heart-fill"></i></a> {{object.get_count_post}}</span>
                <span style="font-size: 14px">{% if user.is_superuser or user|has_group:"Moder"  %}
                    {{object.get_post_status_display}}
                    {% if object.post_status != 'Apr' %}
                <a href="{% url 'admin:change_status_post' object.slug 'Apr'%}">
                    <i class="bi bi-check2-square"></i></a>
                {% endif %}
                {% if object.post_status != 'Del' %}
                <a href="{% url 'admin:change_status_post' object.slug 'Del'%}">
                    <i class="bi bi-trash"></i></a>
                {% endif %}
                    {% if object.post_status != 'Can' %}
                    <a href="{% url 'admin:change_status_post' object.slug 'Can'%}">
                        <i class="bi bi-x-octagon"></i></a>
                    {% endif %}{% endif %} </span> </p>
            <hr>
            {% if object.get_reason %}
            <h3 class="text-center">Причина отклонения статьи</h3>
            {% for i in object.get_reason %}
            <div class="alert alert-danger text-center" role="alert">
            <strong>От {{i.user_id.username}}</strong> {{i.text}}
                <br>
                {{i.date_create}}
            </div>

            <hr>
            {% endfor %}
            {% endif %}
            <p class="text-justify">{{object.text}}</p>
        </div>
        <div class="col-2"></div>
    </div>
    <br>
    <div class="row">

        <div class="col-2"></div>
        <div class="col-md-auto">

            {% if object.user_id.avatar %}
                <div class="">
                    <img src="{{ object.user_id.avatar.url }}"
                         alt="{{ object.user_id.name }} {{ object.user_id.surname }}"
                         height="50px">
                </div>
            {% endif %}
        </div>
        <div class="col">
            <p class="">Автор: {{object.user_id.username}}
                <span id="like_user" style="font-size: 14px">
                    <a
                            {% if user.is_authenticated %}
                                href="{% url 'main:like' object.user_id.pk 'user' %}"
                            {% else %}
                                href="#myModal" data-toggle="modal"
                            {% endif %}>
                        <i class="bi bi-heart-fill"></i>
                    </a>
                    {{object.get_count_user}}
                </span>
            </p>
        </div>
        <div class="col text-justify text-primary" id="formReview">
            <p class="">Дата создания: {{object.date_create}}</p>
                {%  if object.post_updated %}
                    <p class="text-center">Дата обновления: {{object.date_update}}</p>
                {% endif %}
        </div>
        <div class="col-2"></div>

    </div>

    <br>

    <div class="row">
        <div class="col-2"></div>
        <div class="col">
            {% if user.is_authenticated %}
                <button class="open-button" id="open-button" onclick="openForm()">Комментировать</button>
            {% endif %}
        </div>
        <div class="col-2"></div>
    </div>

    <div class="row">
        <div class="col-2"></div>
        <div class="col">
            <div class="comment" id="commentsForm">
                <form action="" method="post">
                    {% csrf_token %}
                    {% for field in form %}
                    <input type="hidden" name="parent" id="contactparent" value="">
                    <p class="form-con">{{field}}</p>
                    {% endfor %}
                    <div class="">
                        {% if user.is_authenticated %}
                        <button type="submit" value="отправить" name="save-article" class="btn btn-primary">Отправить</button>
                        <button type="button" class="btn btn-primary" onclick="closeForm()">Закрыть</button>
                        {% else %}
                        <button type="submit" value="отправить" name="save-article" class="btn btn-primary">
                            <a href="#myModal" data-toggle="modal" style="color: white;">Отправить</a>
                            <button type="button" class="btn btn-primary" onclick="closeForm()">Закрыть</button>
                        </button>
                        {% endif %}
                    </div>
                </form>

            </div>
        </div>
        <div class="col-2"></div>
    </div>


    <div class="row">
        <div class="col-2"></div>
        <div class="col">
            <div class="row">
                <p class="col h4">Коментариев: {{object.count_all_comment}}</p>
            </div>

            {% if comments %}
            <div class="text-center" role="alert">

                {% for comment in comments %}
                <div class="row">
                    <div class="col shadow-sm p-3 mb-5 bg-light rounded">
                        <p style="text-align: left">{{comment.text}}</p>
                        <span id="like_comment" style="font-size: 14px">
                            <a {% if user.is_authenticated %} href="{% url 'main:like' comment.pk 'comment' %}" {% else %} href="#myModal" data-toggle="modal" {% endif %}>
                                <i class="bi bi-heart-fill"></i>
                            </a>{{comment.get_count_comment}}</span>
                        <p style="text-align: right" class="text-primary">Автор: {{comment.user_id.username}}
                            <br>
                            {{comment.date_create}}
                        </p>
                        {% if user.is_authenticated %}
                            <a href="#formReview" onclick="addReview('{{comment.user_id.username}}', '{{comment.id}}')">Ответить</a>
                        {% endif %}
                    </div>
                    <div class="col-2"></div>
                </div>

                {% for answer in comment.get_review %}

                <div class="row">
                    <div class="col-1"></div>
                    <div class="col shadow-sm p-3 mb-5 bg-light rounded">
                        <p style="text-align: left">{{answer.text}}</p>
                        <span style="font-size: 14px">
                            <a {% if user.is_authenticated %} href="{% url 'main:like' answer.pk 'comment' %}" {% else %} href="#myModal" data-toggle="modal" {% endif %}>
                                <i class="bi bi-heart-fill"></i>
                            </a>{{answer.get_count_comment}}</span>
                        <p style="text-align: right" class="text-primary">Автор: {{answer.user_id.username}}
                            <br>
                            {{answer.date_create}}
                        </p>
                        <!--                        <a href="#formReview" onclick="addReview('{{comment.user_id.username}}', '{{comment.id}}')">Ответить</a>  # Может позже другие уровни ответов-->
                    </div>
                    <div class="col-2"></div>
                </div>
                {% endfor %}
                {% endfor %}
            </div>
        </div>


    </div>

    {% endif %}

</div>
{% endblock %}
